Function Parse-IniFile {
    <#
        .SYNOPSIS
        Describe purpose of "Parse-IniFile" in 1-2 sentences.

        .DESCRIPTION
        Add a more complete description of what the function does.

        .PARAMETER file
        Describe parameter -file.

        .EXAMPLE
        Parse-IniFile -file Value
        Describe what this call does

        .NOTES
        Place additional notes here.

        .LINK
        URLs to related sites
        The first link is opened by Get-Help -Online Parse-IniFile

        .INPUTS
        List of input types that are accepted by this function.

        .OUTPUTS
        List of output types produced by this function.
    #>



    [CmdletBinding(ConfirmImpact='None')]
    param
    (
        [string] $file
    )

    $ini = @{}

    # Create a default section if none exist in the file. Like a java prop file.
    $section = 'NoSection'
    $ini[$section] = @{}

    switch -regex -file $file {
        '^\[(.+)\]$' {
        $section = $matches[1].Trim()
        $ini[$section] = @{}
        }
        '^\s*([^#].+?)\s*=\s*(.*)' {
        $name,$value = $matches[1..2]
        # skip comments that start with semicolon:
        if (!($name.StartsWith(';'))) {
            $ini[$section][$name] = $value.Trim()
        }
        }
    }
    $ini
}
